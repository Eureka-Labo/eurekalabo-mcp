---
name: eureka-pr-creator
description: Automatically generates GitHub pull requests from completed branch tasks with AI-generated descriptions in Japanese and English. Use when user says 'create PR', 'make pull request', or when all branch tasks are completed.
allowed-tools: mcp__eureka-tasks__*, Bash(git:*)
---

# Pull Request Creator

Automatically generates comprehensive pull requests from completed work sessions with intelligent descriptions, task summaries, and change analysis.

## Auto-Activation Triggers

- **Keywords**: "create PR", "create pull request", "make PR", "open pull request", "submit PR"
- **Context**: After completing task work session
- **Automatic**: When all tasks in current branch are completed

## Workflow

### Step 1: Check Branch Status
```bash
git branch --show-current
git status
git log origin/main..HEAD --oneline
```

Verify:
- âœ… Not on main/master branch
- âœ… Branch has commits ahead of base
- âœ… Working directory is clean
- âœ… All changes are committed

### Step 2: Get Branch Tasks
```javascript
const branchTasks = await mcp__eureka-tasks__list_branch_tasks();
```

Check:
- Tasks associated with current branch
- Completion status of each task
- Work session summaries
- Git changes captured per task

### Step 3: Analyze Git Changes
```bash
git diff origin/main...HEAD
git log origin/main..HEAD --format="%H|%an|%ae|%ad|%s"
```

Extract:
- Total lines added/removed
- Files modified per task
- Commit messages and authors
- Change patterns (features, fixes, refactors)

### Step 4: Generate Smart PR Description
```javascript
const prDescription = await mcp__eureka-tasks__generate_smart_pr_description({
  branchTasks: tasks,
  gitDiff: diffOutput,
  baseBranch: "main"
});
```

This uses the **technical-writer sub-agent** to create:
- **Japanese summary** (primary)
- **English summary** (for international teams)
- Task-based change breakdown
- Testing notes
- Deployment considerations

### Step 5: Create Pull Request
```javascript
// Option 1: Automatic PR creation
const result = await mcp__eureka-tasks__create_pull_request({
  title: prDescription.title, // Optional - auto-generated if omitted
  baseBranch: "main"
});

// Option 2: Manual with gh CLI
// Returns PR markdown for review before creation
```

### Step 6: Link PR to Tasks
```javascript
// Automatically updates all branch tasks with PR URL
// Tasks now show PR status in Eureka dashboard
```

## PR Description Format

### Generated Structure

```markdown
## æ¦‚è¦ (Summary)

{Japanese description of changes - 2-3 sentences}

## Summary

{English description of changes - 2-3 sentences}

## å¤‰æ›´å†…å®¹ (Changes)

### ã‚¿ã‚¹ã‚¯: {Task Title 1}
- {Change description in Japanese}
- å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«: `path/to/file1.ts`, `path/to/file2.tsx`
- ã‚³ãƒŸãƒƒãƒˆ: `abc1234` - {commit message}

### ã‚¿ã‚¹ã‚¯: {Task Title 2}
- {Change description in Japanese}
- å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«: `path/to/file3.ts`
- ã‚³ãƒŸãƒƒãƒˆ: `def5678` - {commit message}

## ãƒ†ã‚¹ãƒˆ (Testing)

- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ»æ›´æ–°
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ç¢ºèª

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ¢ (Deployment Notes)

{Any special deployment considerations}

## çµ±è¨ˆ (Statistics)

- ðŸ“ ã‚¿ã‚¹ã‚¯æ•°: {taskCount}
- ðŸ“Š å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«: {fileCount} files
- âž• è¿½åŠ : {linesAdded} lines
- âž– å‰Šé™¤: {linesDeleted} lines
- ðŸ’» ã‚³ãƒŸãƒƒãƒˆ: {commitCount} commits

---

ðŸ¤– Generated by [Eureka Tasks](https://eurekalabo.com) with Claude Code
```

## Smart Features

### 1. Automatic Task Creation for Orphan Branches

If branch has commits but NO tasks:
```javascript
// Automatically creates a task from git history
const task = await mcp__eureka-tasks__create_task({
  title: "{Auto-generated Japanese title from commits}",
  description: "{Analysis of what changed}"
});

// Links task to branch
// Creates work session retroactively
// Then generates PR normally
```

### 2. Multi-Task PR Consolidation

When branch has multiple completed tasks:
```
PR Title: {Feature name from main task or commits}

Body:
- Groups related tasks
- Shows task hierarchy (parent â†’ subtasks)
- Maintains individual work session summaries
```

### 3. Conventional Commit Analysis

Analyzes commits to categorize changes:
```
feat: New features added
fix: Bugs fixed
refactor: Code improvements
docs: Documentation updates
test: Test additions
chore: Maintenance tasks
```

### 4. Bilingual Support

Generates both Japanese (primary) and English descriptions:
```markdown
## æ¦‚è¦
èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã«JWTãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

## Summary
Added JWT token refresh functionality to authentication system.
```

## Integration with Existing Workflow

### Automatic PR Creation on Task Completion

```javascript
// When completing last task in branch
await mcp__eureka-tasks__complete_task_work({
  taskId: "task-123",
  summary: "èªè¨¼æ©Ÿèƒ½ã‚’å®Œæˆã•ã›ã¾ã—ãŸ",
  createPR: true  // â† Automatic PR creation
});

// Skill activates automatically:
// 1. Validates all branch tasks complete
// 2. Generates PR description
// 3. Creates GitHub PR
// 4. Links PR to all tasks
// 5. Notifies user with PR URL
```

### Manual PR Creation

```javascript
User: "Create a pull request for this feature"

â†’ Skill activates
â†’ Gathers branch tasks and changes
â†’ Generates description
â†’ Shows preview to user
â†’ Confirms before creating
```

## Error Handling

### No Tasks in Branch
```
âš ï¸ No Eureka tasks found for current branch: {branchName}

Options:
1. Auto-create task from git history (recommended)
2. Manually create task and link
3. Create PR without task tracking (not recommended)

Would you like me to auto-create a task?
```

### Incomplete Tasks
```
âš ï¸ Branch has incomplete tasks:
- "APIçµ±åˆå®Ÿè£…" (50% complete, 2/4 subtasks done)
- "UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ" (in_progress)

Cannot create PR until all tasks are completed.

Complete tasks first:
1. mcp__eureka-tasks__complete_task_work({ taskId: "..." })
2. Or mark tasks as done if work is finished
```

### No GitHub Integration
```
âŒ GitHub CLI not configured

PR description is ready, but cannot create PR automatically.

Options:
1. Install and authenticate GitHub CLI:
   gh auth login

2. Manual PR creation:
   - Push branch: git push origin {branchName}
   - Use description below to create PR manually

{Generated PR Description}
```

### Merge Conflicts
```
âš ï¸ Branch has merge conflicts with main

Resolve conflicts before creating PR:
1. git fetch origin main
2. git merge origin/main
3. Resolve conflicts
4. git commit
5. Try PR creation again
```

## Examples

### Example 1: Simple Feature PR

```
User: "Create PR for authentication feature"

ðŸ” Analyzing branch: feature/jwt-auth

Branch Tasks:
âœ… JWTèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å®Ÿè£…
âœ… ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ 
âœ… èªè¨¼ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

ðŸ“Š Changes:
- 5 files modified
- 234 lines added, 18 deleted
- 3 commits by æ¨‹å· è£•æ¬¡éƒŽ

ðŸ¤– Generating PR description...

âœ… PR Description Ready

Title: feat: JWTèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

[Shows preview of description]

Create this PR? (y/n): y

ðŸš€ Creating pull request...

âœ… PR Created: https://github.com/org/repo/pull/123

Updated 3 tasks with PR link.
```

### Example 2: Multi-Task Feature

```
User: "All tasks done, create the PR"

ðŸ” Branch: feature/payment-integration

Completed Tasks (4):
âœ… æ±ºæ¸ˆAPIçµ±åˆ (parent)
  â”œâ”€ âœ… Stripe SDKå®Ÿè£… (frontend subtask)
  â”œâ”€ âœ… æ±ºæ¸ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½œæˆ (backend subtask)
  â””â”€ âœ… æ±ºæ¸ˆãƒ†ã‚¹ãƒˆå®Ÿè£… (testing subtask)

ðŸ“Š Comprehensive Changes:
- Frontend: 8 files (React components, hooks)
- Backend: 5 files (API routes, services)
- Tests: 6 files (unit + integration)
- Total: 567 lines added, 45 deleted

ðŸ¤– Generating consolidated PR description...

âœ… PR Ready: feat: æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ çµ±åˆ (Payment System Integration)

[Shows hierarchical description with all tasks]

ðŸš€ Creating PR...

âœ… PR Created: https://github.com/org/repo/pull/124
   All 4 tasks updated with PR link.

Dashboard: https://eurekalabo.com/projects/xxx/tasks
```

### Example 3: Auto-Task Creation

```
User: "Create PR"

âš ï¸ No tasks found for branch: hotfix/login-bug

I can create a task automatically from your commits:

Detected Changes:
- fix: ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®500ã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
- test: ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆè¿½åŠ 

Auto-generated Task:
Title: "ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚°ã®ä¿®æ­£"
Description: "500ã‚¨ãƒ©ãƒ¼ã®åŽŸå› ã‚’ç‰¹å®šã—ã¦ä¿®æ­£ã€‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æ”¹å–„ã—ã€ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã€‚"

Create this task and PR? (y/n): y

âœ… Task created: cmxxx...
âœ… Work session retroactively logged
ðŸš€ Creating PR...

âœ… PR Created: https://github.com/org/repo/pull/125
```

## Configuration

### PR Title Templates

```javascript
// Conventional Commits format
"feat: {Japanese feature name}"
"fix: {Japanese bug description}"
"refactor: {Japanese refactor description}"

// Custom format
"{Task title prefix}: {Main change summary}"
```

### Base Branch Detection

```javascript
// Auto-detects from git
const baseBranch =
  currentBranch.startsWith('hotfix/') ? 'main' :
  currentBranch.startsWith('release/') ? 'develop' :
  'main'; // default

// Override with parameter
createPR({ baseBranch: 'develop' })
```

### Auto-PR Threshold

```javascript
// Create PR automatically when:
completedTasks >= 1 &&
allTasksInBranchComplete &&
noMergeConflicts
```

## Best Practices

1. **Complete all tasks before PR**: Ensures comprehensive description
2. **Review generated description**: Skill shows preview before creating
3. **Clean commit history**: Squash/rebase if needed before PR creation
4. **Link related issues**: PR description includes task IDs for traceability
5. **Test before PR**: Run tests and linting first

## Performance

- Description generation: 5-10 seconds (uses sub-agent)
- Git analysis: 1-2 seconds
- PR creation: 2-3 seconds (GitHub API)
- Total: ~10-15 seconds for complete PR creation

## Permissions Required

- Git: Read repository, get diff, log, branch info
- GitHub: Create pull request, update PR description
- Eureka Tasks: Read tasks, update task metadata with PR URL
